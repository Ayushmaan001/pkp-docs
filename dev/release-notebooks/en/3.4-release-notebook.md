---
generateHeadingToc: true
title: OJS/OMP/OPS 3.4 Release Notebook
---

# Release Notebook for OJS/OMP/OPS 3.4

OJS, OMP and OPS version 3.4 was [released](...) on **********. This release notebook provides technical guidance on changes that will impact software developers, plugin and theme authors, and anyone who works with the application codebase.

## PHP 8.0+

The minimum required version of PHP is 8.0 or above, following PHP's [version support schedule](https://www.php.net/supported-versions.php).

## Locales

The country code has been dropped from many locale keys. For example, `en_US` is now `en`. You may need to update the `locale` setting in the `[i18n]` section of `config.inc.php`. Supported locales can be found in the `locale` directory.

Plugin and theme developers should rename the `locale` directories in their plugin.

## Database Drivers

`mysqli` and `postgres9` are the only valid values for the `driver` setting in the `[database]` section of `config.inc.php`.

## Client Charset

The `client_charset` setting has been removed from `config.inc.php`. Only the UTF-8 charset is supported now.

## New Timezone Setting

A new `time_zone` setting has been added to the `[general]` section of `config.inc.php`. See `config.TEMPLATE.inc.php` for supported timezones.

## Email

`PHPMailer` was replaced with [Laravel's Mailer](https://laravel.com/docs/9.x/mail). Add the following to the `[email]` section of your `config.inc.php`:

```
; Default method to send emails
; Available options: sendmail, smtp, log, phpmailer
default = sendmail
```

Servers that use `sendmail` may need to add the path to the sendmail binary:

```
; Path to the sendmail, -bs argument is for using SMTP protocol
sendmail_path = "/usr/sbin/sendmail -bs"
```

It is now possible to send mail through third-party service providers like Mailgun. For sandbox environments, you can redirect mail to log files. Read [Utilities > Email](/dev/documentation/en/utilities-email) to learn more.

## Jobs and Queues

Jobs and queues are now used to manage long-running tasks. By default, these jobs will be processed during normal web requests, which may impact your site's performance.

We recommend setting up a [worker daemon](/admin-guide/en/configure#job-runner) to process jobs.

## New Date/Time Formats

Valid date and time formats in `config.inc.php` must now be specified in [PHP DateTime formatting](https://www.php.net/manual/en/datetime.format.php). Recommended defaults can be found in the `config.TEMPLATE.inc.php` file.

```
date_format_short = "Y-m-d"
date_format_long = "F j, Y"
datetime_format_short = "Y-m-d h:i A"
datetime_format_long = "F j, Y - h:i A"
time_format = "h:i A"
```

The old formats are deprecated and support may be removed at any point.

## Statistics

Our statistics framework has been rewritten to support COUNTER R5, geographic stats, and institutional stats.

TODO: link to stats section in admin guide and/or dev docs with more details.

## Remove Unvalidated Accounts

A new `user_validation_period` setting has been added to the `[general]` section of `config.inc.php`. Use this setting to automatically delete accounts from users who never validated their account. See `config.TEMPLATE.inc.php` for a recommended default.

## Namespaces and Constants

Namespaces are now used in all PHP code in the software and many global constants have been replaced with class constants. This is a major change to our codebase that will require changes in most plugins or themes.

We strongly encourage you to use a code editor that supports autocomplete to help you import classes, discover methods and constants, and identify syntax errors. Type hinting is used throughout more of the codebase now in order to make it easier to understand and write code for our applications.

The `import()` statements and global constants like this are no longer used:

```php
import('classes.submission.Submission');
import('lib.pkp.classes.author.PKPAuthor');

$submission = new Submission();
$author = new PKPAuthor();

$submission->setData('status', STATUS_PUBLISHED);
```

Replace this code with `use` statements and class constants:

```php
use APP\submission\Submission;
use PKP\author\Author;

$submission = new Submission();
$author = new PKPAuthor();

$submission->setData('status', Submission::STATUS_PUBLISHED);
```

Plugin and theme developers who want to use namespaces should read the [instructions on how to adapt plugins](https://github.com/pkp/pkp-lib/issues/6091#issuecomment-796314189).

TODO: update plugin guide and link to that instead.

## HookRegistry Renamed

The `HookRegistry` class has been deprecated. Prepare for it to be removed in a future version by replacing this code:

```php
HookRegistry::register('...', function($hookName, $args) {});
HookRegistry::call('...', [$a, $b]);
```

With this code:

```php
use PKP\plugins\Hook;

Hook::add('...', function($hookName, $args) {});
Hook::call('...', [$a, $b]);
```

## Localization

We have replaced the `PKPLocale` and `APPLocale` classes with a new facade class. Read the [Utilities > Translation](/dev/documentation/en/utilities-translation) section of the developer docs to learn more about working with translations.

There is also a detailed [description of changes](https://github.com/pkp/pkp-docs/issues/953).

## Repositories

A `Repo` facade has been introduced to read and write data for many entities, such as submissions and authors. When a `Repository` class exists, plugin and theme developers should use the `Repo` facade instead of the `DAO` class to read and write data.

Replace code like this:

```php
$submissionDao = DAORegistry::getDAO('SubmissionDAO');
$submission = $submissionDao->getById($id);
$submission->setData('submissionProgress', 0);
$submissionDao->updateObject($submission);
```

With code like this:

```php
use APP\facades\Repo;

$submission = Repo::submission()->get($id, $contextId);

Repo::submission()->edit(
    $submission,
    [
        'submissionProgress' => 0,
    ]
);
```

A `Repository` isn't available for all entities. Learn more about [Repositories](/dev/documentation/en/architecture-repositories).

## Events

TODO: section on new observer pattern. Link to utilities/events in dev docs.

## Editorial Decisions

TODO: section on new editorial decision patterns. Link to other/decisions in dev docs.

## Submission Wizard

TODO: new submission wizard UI. Link to [forms section](/dev/documentation/en/frontend-forms) in dev docs.

## REST API

Several new endpoints were added to the REST API for working with statistics, editorial decisions, contributors and submissions. See what's changed in the [3.4 API Reference](/dev/api/ojs/3.4.html).

## UI Library

New components were added to the UI Library, such as [Dialog](/dev/ui-library/dev/#/utilities/Dialog), [Composer](/dev/ui-library/dev/#/component/Composer), [FileAttacher](/dev/ui-library/dev/#/component/FileAttacher), [Steps](/dev/ui-library/dev/#/component/Steps), and more. View everything in the [UI Library](https://docs.pkp.sfu.ca/dev/ui-library/dev).

## Removed Code

As part of our efforts to modernize the code, several functions were removed, deprecated or replaced.

Get galley file ids from the new `Galley` object.

```diff
- ArticleGalley::getFileId();
- ArticleGalley::setFileId();
- PreprintGalley::getFileId();
- PreprintGalley::setFileId();
+ PKP\galley\Galley::getData('submissionFileId');
```

Don't use these methods to work with submission cover images.

```diff
- Submission::getCoverImage();
- Submission::getLocalizedCoverImage();
- Submission::getCoverImageAltText();
- Submission::getLocalizedCoverImageAltText();
- Submission::getLocalizedCoverImageUrl();
```

Get the cover image info from the `Publication` object instead.

```diff
+ APP\publication\Publication::getLocalizedData('coverImage');
+ APP\publication\Publication::getLocalizedCoverImageUrl($contextId);
```

Several deprecated `Submission` methods have been removed. Use `Publication` methods instead.

```diff
- Submission::getAuthorString()
- Submission::getShortAuthorString()
- Submission::getPrimaryAuthor()
+ APP\publication\Publication::getAuthorString($userGroups)
+ APP\publication\Publication::getShortAuthorString()
+ APP\publication\Publication::getPrimaryAuthor()
```

For theme templates, this will require a change like this:

```diff
- {$article->getAuthorString()|escape}
+ {$article->getCurrentPublication()->getAuthorString($authorUserGroups)|escape}
```

Use `getSignature()` to get a user's contact signature:

```diff
- User::getContactSignature()
+ PKP\user\User::getSignature(Locale::getLocale())
```

Use `Repo::section()` to get section data:

```diff
- DAORegistry('UserGroupDAO')->...;
+ Repo::section()->...
```

Use `DB` facade instead of `Capsule` to access Laravel's QueryBuilder:

```diff
- use Illuminate\Database\Capsule\Manager as Capsule;
- Capsule::table('submissions')->...
+ use Illuminate\Support\Facades\DB;
+ DB::table('submissions')->...
```

The `Mail` and `SubmissionMail` classes were removed in favor of `Mailables`. Read [Utilities > Email](/dev/documentation/en/utilities-email) to learn more.
